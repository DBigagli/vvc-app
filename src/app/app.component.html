<div id="vvc-container"
     *ngIf="!widgetState?.minimized"
     [ngClass]="{'mobile':widgetState?.mobile,'fullsize':widgetState?.fullScreen, 'nochat':!widgetState?.chatVisibility && widgetState?.fullScreen}">

  <vvc-fullscreen id="vvc-full-enabled"
                  *ngIf="widgetState?.fullScreen"
                  [state]="widgetState"
                  (hangup)="setNormalScreen();hangup()"
                  (addvideo)="addLocalVideo()"
                  (remvideo)="removeLocalVideo()"
                  (minimize)="setNormalScreen()"
                  (showchat)="setChatVisibility($event)"
                  (mute)="setMute($event)"></vvc-fullscreen>

  <vvc-initial-data id="vvc-initial-data"
                    *ngIf="widgetState?.state === 'waiting_data'"
                    [dataCollection]="widgetState?.dataCollections[widgetState.selectedDataCollectionId]"
                    (datasubmit)="submitInitialData(widgetState.selectedDataCollectionId, $event)"
                    (abandon)="abandon()"></vvc-initial-data>

  <vvc-queue id="vvc-queue"
             *ngIf="widgetState?.state === 'queue'"
             [type]="type"
             (leave)="leave()"></vvc-queue>

  <div id="vvc-widget-wrap"
       [ngClass]="{'no-chat': !widgetState?.chat && !widgetState?.had_chat}"
       *ngIf="widgetState?.state === 'ready'">

    <vvc-topbar id="vvc-top-bar"
                [ngClass]="{'expanded': (widgetState?.topBarExpanded && !widgetState?.video)}"
                [state]="widgetState"
                (close)="showCloseModal($event)"
                (minimize)="minimize(true)"
                (upgrade)="upgradeMedia($event)"></vvc-topbar>

    <vvc-media-tools id="vvc-media-tools"
                     *ngIf="widgetState?.voice && !widgetState?.fullScreen"
                     [state]="widgetState"
                     (hangup)="hangup()"
                     (addvideo)="addLocalVideo()"
                     (remvideo)="removeLocalVideo()"
                     (maximize)="setFullScreen()"
                     (mute)="setMute($event)"></vvc-media-tools>

    <vvc-no-chat id="vvc-no-chat"
                 *ngIf="!widgetState?.chat && !widgetState?.had_chat"
                 [state]="widgetState"></vvc-no-chat>

    <div id="vvc-messages"
         *ngIf="widgetState?.chat || widgetState?.had_chat"
         angular2-auto-scroll>
      <div *ngFor="let m of messages">
        <vvc-chat-message *ngIf="m.type === 'chat'"
                          [message]="m"
                          (download)="download($event)"></vvc-chat-message>
        <vvc-incoming-message *ngIf="(m.type === 'incoming-request' || m.type === 'incoming-offer') && m.media != 'DC'"
                              [message]="m"
                              (rejectOffer)="denyIncomingRequest($event, m)"
                              (acceptOffer)="acceptIncomingRequest($event, m)"></vvc-incoming-message>
        <vvc-inc-dc *ngIf="m.type === 'incoming-request' && m.media === 'DC'"
                    [message]="m"
                    [dc]="widgetState?.dataCollections[m.dataCollectionId]"
                    (show)="showDataCollection($event)"
                    (submit)="sendDataCollection($event)"></vvc-inc-dc>
      </div>
    </div>

    <vvc-chat-box id="vvc-chat-area" *ngIf="!widgetState?.closed && widgetState?.chat"
                  (upload)="sendAttachment($event)"
                  (message)="sendChatMessage($event)"></vvc-chat-box>

    <vvc-dc-viewer id="vvc-dc-viewer"
                   *ngIf="selectedDataMessage"
                   [dc]="widgetState?.dataCollections[selectedDataMessage.dataCollectionId]"
                   [message]="selectedDataMessage"
                   (submit)="sendDataCollection($event);selectedDataMessage = undefined;"
                   (close)="syncDataCollection($event);selectedDataMessage = undefined;"></vvc-dc-viewer>

    <vvc-close-modal id="vvc-close-modal"
                     *ngIf="closeModal"
                     (close)="closeContact($event)"
                     (cancel)="dismissCloseModal()"></vvc-close-modal>

    <vvc-survey id="vvc-survey"
                *ngIf="widgetState?.showSurvey"
                [dataCollection]="widgetState?.dataCollections[widgetState.surveyId]"
                (close)="closeOnSurvey()"></vvc-survey>

  </div>

  <vvc-video-thumbs id="vvc-video-thumbs"
                    vvcDraggable
                    *ngIf="widgetState?.mobile && widgetState?.video && !widgetState?.fullScreen"
                    [state]="widgetState"
                    (maximize)="setFullScreen()"></vvc-video-thumbs>
</div>

<vvc-minimized id="vvc-minimized"
               *ngIf="widgetState?.minimized"
               [state]="widgetState"
               (click)="minimize(false)"></vvc-minimized>

