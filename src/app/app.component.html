<div id="vvc-container" [ngClass]="{'fullsize':widgetState.fullScreen, 'nochat':!widgetState.chatVisibility && widgetState.fullScreen}">

  <vvc-fullscreen id="vvc-full-enabled"
                  *ngIf="widgetState?.fullScreen"
                  [state]="widgetState"
                  (hangup)="setNormalScreen();hangup()"
                  (addvideo)="addLocalVideo()"
                  (remvideo)="removeLocalVideo()"
                  (minimize)="setNormalScreen()"
                  (showchat)="setChatVisibility($event)"
                  (mute)="setMute($event)"></vvc-fullscreen>

  <vvc-initial-data id="vvc-initial-data"
                    *ngIf="widgetState?.state === 'waiting_data'"
                    [dataCollection]="widgetState.dataCollections[widgetState.selectedDataCollectionId]"
                    (datasubmit)="submitInitialData()"
                    (abandon)="abandon()"></vvc-initial-data>

  <vvc-queue id="vvc-queue"
             *ngIf="widgetState?.state === 'queue'"
             [type]="type"></vvc-queue>

  <div id="vvc-widget-wrap"
       *ngIf="widgetState?.state === 'ready'">

    <vvc-topbar id="vvc-top-bar"
                [ngClass]="{'expanded':widgetState?.topBarExpanded}"
                [state]="widgetState"
                (close)="showCloseModal($event)"
                (upgrade)="upgradeMedia($event)"></vvc-topbar>

    <vvc-media-tools id="vvc-media-tools"
                     *ngIf="widgetState?.voice && !widgetState.fullScreen"
                     [state]="widgetState"
                     (hangup)="hangup()"
                     (addvideo)="addLocalVideo()"
                     (remvideo)="removeLocalVideo()"
                     (maximize)="setFullScreen()"
                     (mute)="setMute($event)"></vvc-media-tools>

    <div id="vvc-messages" angular2-auto-scroll>
      <div *ngFor="let m of messages">
        <vvc-chat-message *ngIf="m.type === 'chat'"
                          [message]="m"
                          (download)="download($event)"></vvc-chat-message>
        <vvc-incoming-message *ngIf="m.type === 'incoming-request' && m.media != 'DC'"
                              [message]="m"
                              (rejectOffer)="denyIncomingRequest($event)"
                              (acceptOffer)="acceptIncomingRequest($event)"></vvc-incoming-message>
        <vvc-inc-dc *ngIf="m.type === 'incoming-request' && m.media === 'DC'"
                    [message]="m"
                    (show)="showDataCollection($event)"></vvc-inc-dc>
      </div>
    </div>

    <vvc-chat-box id="vvc-chat-area" *ngIf="!widgetState.closed"
                  (upload)="sendAttachment($event)"
                  (message)="sendChatMessage($event)"></vvc-chat-box>

    <div id="vvc-dc-viewer" *ngIf="selectedDataCollectionId">
      {{ widgetState.dataCollections[selectedDataCollectionId] | json }}


      <button (click)="selectedDataCollectionId = undefined">Close</button>
    </div>


    <vvc-close-modal id="vvc-close-modal"
                     *ngIf="closeModal"
                     (close)="closeContact($event)"
                     (cancel)="dismissCloseModal()"></vvc-close-modal>

    <vvc-survey id="vvc-survey"
                *ngIf="widgetState.showSurvey"
                [dataCollection]="widgetState.dataCollections[widgetState.surveyId]"
                (close)="closeOnSurvey()"></vvc-survey>

  </div>

</div>